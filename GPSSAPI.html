<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TIPO API 專利檢索測試</title>
    <style>
        body { font-family: "Microsoft JhengHei", sans-serif; padding: 20px; background-color: #f4f7f6; }
        .container { max-width: 900px; margin: 0 auto; background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        h2 { color: #333; border-left: 5px solid #007BFF; padding-left: 10px; }
        .input-group { margin: 20px 0; display: flex; flex-direction: column; gap: 10px; }
        input[type="text"] { padding: 12px; border: 1px solid #ddd; border-radius: 4px; font-size: 14px; }
        button { padding: 12px; cursor: pointer; background-color: #28a745; color: white; border: none; border-radius: 4px; font-size: 16px; font-weight: bold; }
        button:hover { background-color: #218838; }
        #result-display { 
            margin-top: 20px;
            border: 1px dashed #bbb; 
            padding: 15px; 
            background-color: #272822; /* 深色背景模擬工程師界面 */
            color: #f8f8f2;
            min-height: 300px; 
            white-space: pre-wrap; 
            word-break: break-all;
            overflow-y: auto;
            font-family: 'Consolas', monospace;
        }
        .status-msg { font-size: 14px; margin-bottom: 5px; color: #666; }
    </style>
</head>
<body>

<div class="container">
    <h2>智慧財產局 API 檢索工具</h2>
    
    <div class="input-group">
        <label for="apiUrl">請輸入完整 API 網址：</label>
        <input type="text" id="apiUrl" value="https://tiponet.tipo.gov.tw/gpss1/gpsskmc/gpss_api?userCode=您的驗證碼&patDB=TWA,TWB&patAG=A,B&patTY=I&TI=太陽能&ID=20150101:20160101&expFld=PN,AN,ID,AD,TI&expFmt=json&expQty=100">
        <button id="sendBtn">開始獲取專利資料</button>
    </div>

    <div class="status-msg" id="statusMsg">等待指令...</div>
    <div id="result-display">回應結果將顯示於此...</div>
</div>

<script>
    const sendBtn = document.getElementById('sendBtn');
    const apiUrlInput = document.getElementById('apiUrl');
    const resultDisplay = document.getElementById('result-display');
    const statusMsg = document.getElementById('statusMsg');

    sendBtn.addEventListener('click', async () => {
        // 1. 取得網址並處理可能的中文編碼問題
        const rawUrl = apiUrlInput.value.trim();
        if (!rawUrl) {
            alert('請輸入網址');
            return;
        }

        // 使用 encodeURI 處理網址中的中文（如：太陽能）
        const encodedUrl = encodeURI(rawUrl);

        statusMsg.textContent = '正在連線至 TIPO 伺服器...';
        resultDisplay.textContent = '讀取中...';

        try {
            // 2. 發送請求
            const response = await fetch(encodedUrl, {
                method: 'GET',
                mode: 'cors' // 強制開啟跨域模式
            });

            // 3. 檢查狀態碼
            if (!response.ok) {
                throw new Error(`HTTP 錯誤! 狀態碼: ${response.status}`);
            }

            // 4. 解析 JSON
            const data = await response.json();
            statusMsg.textContent = '資料取得成功！';
            resultDisplay.textContent = JSON.stringify(data, null, 4);

        } catch (error) {
            // 5. 錯誤處理 (特別針對 CORS)
            statusMsg.textContent = '連線失敗。';
            resultDisplay.textContent = 
                '【錯誤訊息】\n' + error.message + 
                '\n\n【可能原因】\n' +
                '1. 驗證碼 (userCode) 無效或過期。\n' +
                '2. 瀏覽器 CORS 安全限制 (不允許從本地開啟的檔案存取政府 API)。\n' +
                '3. 網路連線問題。';
            
            console.error('詳細錯誤資訊:', error);
        }
    });
</script>

</body>
</html>